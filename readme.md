# ES1840KB
## _Дизассемблированная (мной) прошивка клавиатуры_ `ЕС1840.С000`
Программист прошивки явно не любил программировать структурно. В частности, при запуске и сбросе клавиатура должна вывести в компьютер `0xAA` и потом коды залипших клавиш. Так вот в этой прошивке есть процедура вывода в порт "на общих основаниях" (при работе) и процедура вывода в порт при инициализации, две почти идентичных.
Сканирование для залипших клавиш при инициализации и сканирование при основной работе - также две отдельных процедуры.
Думаю, при небольшом рефакторинге код можно было бы хорошенько уменьшить.

Исходная клавиатура IBM (прошивка которой, да и схемотехника, совершенно другие) при заполнении своего буфера FIFO выдает в компьютер `0xFF` Клавиатура ЕС1840 просто теряет старые коды в буфере.

Клавиатура имеет ошибку. В отличие от клавиатур AT, где светодиоды зажигаются с компьютера, зажигание светодиодов в клавиатуре ЕС1840 выполняется прошивкой клавиатуры. При команде сброса с компьютера клавиатура гасит светодиоды ЛАТ и ЦИФ, но ничего не делает с РУС (в коде это метка `ledinit:`). Поэтому если перезагрузиться по Ctrl-Alt-Del с горящим светодиодом ЛАТ, после перезагрузки не будет гореть ни один светодиод.
Для устранения этой ошибки нужно после 'ledinit: anl p1,#3fh' вставить зажигание РУС и соответственно изменить контрольную сумму.

Клавиатура при запуске выполняет самотест и проверяет контрольную сумму ПЗУ, должна быть `0x00`.
